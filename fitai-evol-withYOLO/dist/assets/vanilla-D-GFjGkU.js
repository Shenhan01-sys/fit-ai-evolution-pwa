var e={},t={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.replaceNewProxy=e.affectedToPathList=e.markToTrack=e.getUntracked=e.trackMemo=e.isChanged=e.createProxy=void 0;const t=Symbol(),r=Symbol(),n="a",o="f",s="w";let c=(e,t)=>new Proxy(e,t);const a=Object.getPrototypeOf,l=new WeakMap,i=e=>e&&(l.has(e)?l.get(e):a(e)===Object.prototype||a(e)===Array.prototype),f=e=>"object"==typeof e&&null!==e,u=e=>{if(Array.isArray(e))return Array.from(e);const t=Object.getOwnPropertyDescriptors(e);return Object.values(t).forEach(e=>{e.configurable=!0}),Object.create(a(e),t)},p=(c,a)=>{const l={[o]:a};let i=!1;const f=(e,t)=>{if(!i){let r=l[n].get(c);if(r||(r={},l[n].set(c,r)),e===s)r[s]=!0;else{let n=r[e];n||(n=new Set,r[e]=n),n.add(t)}}},u={get:(t,o)=>o===r?c:(f("k",o),(0,e.createProxy)(Reflect.get(t,o),l[n],l.c,l.t)),has:(e,r)=>r===t?(i=!0,l[n].delete(c),!0):(f("h",r),Reflect.has(e,r)),getOwnPropertyDescriptor:(e,t)=>(f("o",t),Reflect.getOwnPropertyDescriptor(e,t)),ownKeys:e=>(f(s),Reflect.ownKeys(e))};return a&&(u.set=u.deleteProperty=()=>!1),[u,l]},y=e=>e[r]||e;e.createProxy=(e,t,r,o)=>{if(!i(e))return e;let s=o&&o.get(e);if(!s){const t=y(e);s=(e=>Object.values(Object.getOwnPropertyDescriptors(e)).some(e=>!e.configurable&&!e.writable))(t)?[t,u(t)]:[t],null==o||o.set(e,s)}const[a,l]=s;let f=r&&r.get(a);return f&&f[1].f===!!l||(f=p(a,!!l),f[1].p=c(l||a,f[0]),r&&r.set(a,f)),f[1][n]=t,f[1].c=r,f[1].t=o,f[1].p};e.isChanged=(t,r,n,o,c=Object.is)=>{if(c(t,r))return!1;if(!f(t)||!f(r))return!0;const a=n.get(y(t));if(!a)return!0;if(o){if(o.get(t)===r)return!1;o.set(t,r)}let l=null;for(const e of a.h||[])if(l=Reflect.has(t,e)!==Reflect.has(r,e),l)return l;if(!0===a[s]){if(l=((e,t)=>{const r=Reflect.ownKeys(e),n=Reflect.ownKeys(t);return r.length!==n.length||r.some((e,t)=>e!==n[t])})(t,r),l)return l}else for(const e of a.o||[]){if(l=!!Reflect.getOwnPropertyDescriptor(t,e)!==!!Reflect.getOwnPropertyDescriptor(r,e),l)return l}for(const s of a.k||[])if(l=(0,e.isChanged)(t[s],r[s],n,o,c),l)return l;if(null===l)throw new Error("invalid used");return l};e.trackMemo=e=>!!i(e)&&t in e;e.getUntracked=e=>i(e)&&e[r]||null;e.markToTrack=(e,t=!0)=>{l.set(e,t)};e.affectedToPathList=(e,t,r)=>{const n=[],o=new WeakSet,c=(e,a)=>{var l,i,u;if(o.has(e))return;f(e)&&o.add(e);const p=f(e)&&t.get(y(e));if(p){if(null===(l=p.h)||void 0===l||l.forEach(e=>{const t=`:has(${String(e)})`;n.push(a?[...a,t]:[t])}),!0===p[s]){const e=":ownKeys";n.push(a?[...a,e]:[e])}else null===(i=p.o)||void 0===i||i.forEach(e=>{const t=`:hasOwn(${String(e)})`;n.push(a?[...a,t]:[t])});null===(u=p.k)||void 0===u||u.forEach(t=>{r&&!("value"in(Object.getOwnPropertyDescriptor(e,t)||{}))||c(e[t],a?[...a,t]:[t])})}else a&&n.push(a)};return c(e),n};e.replaceNewProxy=e=>{c=e}}(t);var r=t;const n=e=>"object"==typeof e&&null!==e,o=(e,t)=>{const n=a.get(e);if((null==n?void 0:n[0])===t)return n[1];const l=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));return r.markToTrack(l,!0),a.set(e,[t,l]),Reflect.ownKeys(e).forEach(t=>{if(Object.getOwnPropertyDescriptor(l,t))return;const n=Reflect.get(e,t),{enumerable:a}=Reflect.getOwnPropertyDescriptor(e,t),i={value:n,enumerable:a,configurable:!0};if(c.has(n))r.markToTrack(n,!1);else if(s.has(n)){const[e,t]=s.get(n);i.value=o(e,t())}Object.defineProperty(l,t,i)}),Object.preventExtensions(l)},s=new WeakMap,c=new WeakSet,a=new WeakMap,l=[1],i=new WeakMap;let f=Object.is,u=(e,t)=>new Proxy(e,t),p=e=>n(e)&&!c.has(e)&&(Array.isArray(e)||!(Symbol.iterator in e))&&!(e instanceof WeakMap)&&!(e instanceof WeakSet)&&!(e instanceof Error)&&!(e instanceof Number)&&!(e instanceof Date)&&!(e instanceof String)&&!(e instanceof RegExp)&&!(e instanceof ArrayBuffer)&&!(e instanceof Promise),y=o,g=(e,t,o,c)=>({deleteProperty(e,t){const r=Reflect.get(e,t);o(t);const n=Reflect.deleteProperty(e,t);return n&&c(["delete",[t],r]),n},set(a,l,u,y){const g=!e()&&Reflect.has(a,l),w=Reflect.get(a,l,y);if(g&&(f(w,u)||i.has(u)&&f(w,i.get(u))))return!0;o(l),n(u)&&(u=r.getUntracked(u)||u);const b=!s.has(u)&&p(u)?h(u):u;return t(l,b),Reflect.set(a,l,b,y),c(["set",[l],u,w]),!0}});function h(e={}){if(!n(e))throw new Error("object required");const t=i.get(e);if(t)return t;let r=l[0];const o=new Set,a=(e,t=++l[0])=>{r!==t&&(f=r=t,o.forEach(r=>r(e,t)))};let f=r;const p=e=>(t,r)=>{const n=[...t];n[1]=[e,...n[1]],a(n,r)},y=new Map;let h=!0;const w=g(()=>h,(e,t)=>{const r=!c.has(t)&&s.get(t);if(r)if(o.size){const t=r[2](p(e));y.set(e,[r,t])}else y.set(e,[r])},e=>{var t;const r=y.get(e);r&&(y.delete(e),null==(t=r[1])||t.call(r))},a),b=u(e,w);i.set(e,b);const d=[e,(e=l[0])=>(f!==e&&(f=e,y.forEach(([t])=>{const n=t[1](e);n>r&&(r=n)})),r),e=>{o.add(e),1===o.size&&y.forEach(([e,t],r)=>{const n=e[2](p(r));y.set(r,[e,n])});return()=>{o.delete(e),0===o.size&&y.forEach(([e,t],r)=>{t&&(t(),y.set(r,[e]))})}}];return s.set(b,d),Reflect.ownKeys(e).forEach(t=>{const r=Object.getOwnPropertyDescriptor(e,t);"value"in r&&r.writable&&(b[t]=e[t])}),h=!1,b}e.getVersion=function(e){const t=s.get(e);return null==t?void 0:t[1]()};var w=e.proxy=h,b=e.ref=function(e){return c.add(e),e},d=e.snapshot=function(e){const t=s.get(e),[r,n]=t;return y(r,n())},k=e.subscribe=function(e,t,r){const n=s.get(e);let o;const c=[],a=n[2];let l=!1;const i=a(e=>{c.push(e),r?t(c.splice(0)):o||(o=Promise.resolve().then(()=>{o=void 0,l&&t(c.splice(0))}))});return l=!0,()=>{l=!1,i()}};e.unstable_getInternalStates=function(){return{proxyStateMap:s,refSet:c,snapCache:a,versionHolder:l,proxyCache:i}},e.unstable_replaceInternalFunction=function(e,t){switch(e){case"objectIs":f=t(f);break;case"newProxy":u=t(u);break;case"canProxy":p=t(p);break;case"createSnapshot":y=t(y);break;case"createHandler":g=t(g);break;default:throw new Error("unknown function")}};export{d as a,w as p,b as r,k as s,e as v};
